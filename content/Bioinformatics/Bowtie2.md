---
title: "Bowtie2"
author: "Romanov Stanislav"
date: "20 01 2022"
output: html_document
lang: russian
tags: ["bowtie2", "bowtie", "Множественное выравнивание", "ChIP-seq", "Fastq alignment"]
---

[Bowtie 2](http://bowtie-bio.sourceforge.net/bowtie2/index.shtml) — это наиболее популярный инструмент для выравнивания коротких фрагментов ДНК на эталонные последовательности. Он особенно хорош для выравнивания ридов длиной от 50 до 100-1000bp на длинные референсные геномы (в т.ч. млекопитающих). Достаточно высокая скорость и эффективное использование оперативной памяти в Bowtie 2 достигается за счет преобразования генома в серию коротких ссылочных последовательностей с помощью [FM-индекса](http://en.wikipedia.org/wiki/FM-index) (на основе [преобразования Барроуза — Уилера](https://mf.grsu.by/UchProc/livak/po/comprsite/theory_bwt.html), [*Burrows-Wheeler transform*](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%91%D0%B0%D1%80%D1%80%D0%BE%D1%83%D0%B7%D0%B0_%E2%80%94_%D0%A3%D0%B8%D0%BB%D0%B5%D1%80%D0%B0#:~:text=%D0%9F%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%91%D0%B0%D1%80%D1%80%D0%BE%D1%83%D0%B7%D0%B0%20%E2%80%94%20%D0%A3%D0%B8%D0%BB%D0%B5%D1%80%D0%B0%20(Burrows%2D,BWT%20%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D1%82%D1%81%D1%8F%20%D0%B2%20%D0%B0%D1%80%D1%85%D0%B8%D0%B2%D0%B0%D1%82%D0%BE%D1%80%D0%B5%20bzip2.),%20*BWT*). Bowtie2 поддерживает режимы выравнивания с пропусками *(gapped alignment)*, локальное *(local alignment)* и выравнивание парных ридов *(paired-end alignment)*.

``` r
blogdown::shortcode("notice","watning" ,.content = "Не следует путать bowtie2 с bowtie. Хотя первый инструмент является предшественником bowtie2, в нем имеется ряд недостатков: отсутствует возможность локального выравнивания (то есть все риды должны выравниваниваться полностью от начала до конца), режим выравнивания парных ридов ограничен и не предназначен для выравнивания дискордантных ридов, отсутсвует поддержка неоднозначных символов (например, N,S). Bowtie обладает низкой эффективностью при выравнивании ридов длинее 50 пар и не способен выравнивать риды длинее 1000 пар. Важно понимать, что геномные индексы, произведенные Bowtie2 и Bowtie взаимозаменяемы только начиная с версии Bowtie v1.2.3.")
```

{{% notice "watning" %}}
Не следует путать bowtie2 с bowtie. Хотя первый инструмент является предшественником bowtie2, в нем имеется ряд недостатков: отсутствует возможность локального выравнивания (то есть все риды должны выравниваниваться полностью от начала до конца), режим выравнивания парных ридов ограничен и не предназначен для выравнивания дискордантных ридов, отсутсвует поддержка неоднозначных символов (например, N,S). Bowtie обладает низкой эффективностью при выравнивании ридов длинее 50 пар и не способен выравнивать риды длинее 1000 пар. Важно понимать, что геномные индексы, произведенные Bowtie2 и Bowtie взаимозаменяемы только начиная с версии Bowtie v1.2.3.
{{% /notice %}}

### Референсные публикации

-   Langmead B, Wilks C, Antonescu V, Charles R. [Scaling read aligners to hundreds of threads on general-purpose processors](https://doi.org/10.1093/bioinformatics/bty648). *Bioinformatics*. 2018 Jul 18. doi: 10.1093/bioinformatics/bty648.

-   Langmead B, Salzberg SL. [Fast gapped-read alignment with Bowtie 2](https://www.nature.com/articles/nmeth.1923). *Nature Methods*. 2012 Mar 4;9(4):357-9. doi: 10.1038/nmeth.1923.

### Официальные материалы

-   [Официальный сайт](http://bowtie-bio.sourceforge.net/bowtie2/index.shtml)

-   Расширенный [мануал](http://bowtie-bio.sourceforge.net/bowtie2/manual.shtml)

-   Список [приложений](http://bowtie-bio.sourceforge.net/bowtie2/other_tools.shtml), использующих bowtie2

-   Архив [геномных индексов](https://benlangmead.github.io/aws-indexes/bowtie) Bowtie2 и Bowtie

### Принцип работы

Подробно о алгоритме преобразования BWT, FM-индексе и связанных с этим алгоритмах можно познакомиться в [видео-лекции](https://www.youtube.com/watch?v=P3ORBMon8aw), [презентации](https://www.cs.jhu.edu/~langmea/resources/lecture_notes/bwt_and_fm_index.pdf) или [учебнике](https://www.cs.cmu.edu/~15451-f18/lectures/lec25-bwt.pdf). Для каждого рида Bowtie2 производит вычисления в четыре шага. На шаге 1 ***(Extract seed)*** Bowtie2 извлекает из рида и комплементарной к нему последовательности (не путать с *mait-pair*) “затравочные” подстроки (*seeds*). На шаге 2 **(*Align with FM-Index*)** затравочные подстроки выравниваются на преобразованный с помощью BWT геном без пропусков (*ungapped, без делеций и инсерций*) с использованием FM-индекса, в результате чего получаются интервалы Барроуза-Уиллера *(BW ranges),* которые указывают на строки втрансформированном с помощью BW геноме. На шаге 3 ***(Prioritize, resolve)*** Bowtie2 выбирает строки из полученных интервалов и каждая строка приобретает приоритет *(prioritize)*, при этом чем меньше интервал - тем выше приоритет. Далее, учитывая приоритет строк, с помощью FM-индекса и алгоритма “walk-left” Bowtie2 определяется смещение *([offset](https://ru.wikipedia.org/wiki/%D0%A1%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_(%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0)#:~:text=%D0%92%20%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B5%2C%20%D1%81%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8%20%D0%BC%D0%B0%D1%81%D1%81%D0%B8%D0%B2%D0%B0,%D0%BE%D0%B4%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%B8%20%D1%82%D0%BE%D0%B3%D0%BE%20%D0%B6%D0%B5%20%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%B0.))* выбранных строк, получая координаты затравочных последовательностей в геноме *(Extention candidates),* иными словами разрешая *(resolve)* затравочные выравнивания. Шаг 4 берет приоритетные разрешенные затравочные выравнивания из шага 3 и выполняет выравнивание рида с в окрестностях каждого из них. Выравнивание на данном этапе ускоряется за счет использования динамического программирования SIMD ([Single Instruction Multiple Data](https://ru.wikipedia.org/wiki/SIMD)). Выравнивание продолжается до тех пор, пока не будут проанализированы все затравочные совпадения *(seed hits)*, пока не будет изучено достаточное количества выравниваний, или пока не будет достигнут предел трудоемкости *(effort limit)* динамического программирования.

![](/Bioinformatics/Bowtie2.files/workflow.png)

Кратко, сначала каждый рид и комплементарная к нему последовательность разбивается на затравочные подстроки *(seed)*. Затем извлеченные подстроки выравниваются на референсный геном без пропусков расставляются по приоритету. На последнем этапе затравочные выравнивания расширяются на весь рид.
